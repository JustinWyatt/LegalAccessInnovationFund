@model LegalAccessInnovationFund.Web.Models.ViewModels.CampaignViewModel

@{
    ViewBag.Title = "CampaignView";
    Layout = "~/Views/Shared/_ApplicationLayout.cshtml";
}

<div class="row">
    <div class="span8 blog">
        <article>
            <h3 class="title-bg">@Model.Title</h3>
            <div class="post-content">
                <img src="@Model.Picture" alt="Post Thumb">
                <div class="post-body">
                    @Model.Story
                </div>
                <div class="post-summary-footer">
                    <ul class="post-data">
                        <li><i class="icon-calendar"></i> @Model.DatePosted</li>
                        <li><i class="icon-comment"></i> <a href="#">5 Comments</a></li>
                    </ul>
                </div>
            </div>
        </article>
        <section class="post-content">
            <div class="post-body about-author">
                <img src="img/author-avatar.jpg" alt="author">
                <h4>About @Model.CampaignStarter</h4>
                @Model.CampaignStarter
            </div>
        </section>
        <section class="comments">
            <h4 class="title-bg"><a name="comments"></a>@Model.Contributions.Count() Contributions</h4>
            <ul>
                @foreach (var item in Model.Contributions)
                {
                    <li>
                        <img src="img/user-avatar.jpg" alt="Image" />
                        <span class="comment-name">John Doe</span>
                        <span class="comment-date">March 15, 2015 | <a href="#">Reply</a></span>
                        <div class="comment-content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam venenatis, ligula quis sagittis euismod, odio ante molestie tortor, eget ullamcorper lacus nunc a ligula. Donec est lacus, aliquet in interdum id, rutrum ac tellus. Ut rutrum, justo et lobortis commodo, est metus ornare tortor, vitae luctus turpis leo sed magna. In leo dolor, suscipit non mattis in.</div>
                    </li>
                }
            </ul>
        </section>
    </div>

    <div class="span4 sidebar">
        <h5 class="title-bg">Campaign Contributions</h5>
        @{
            var calc =  Model.Contributions.Sum(x => x.Amount) / Model.Goal;
            var percentage = Math.Round(calc, 0);
        }
        <h6 class="title-bg">Goal: <small>@Model.Goal</small></h6>
        <div class="progress progress-info progress-striped">
            <div class="bar span4" style="width: @percentage%"></div>
        </div>
        <h5 class="title-bg">Donation Levels</h5>
        <ul class="popular-posts">
            @foreach (var item in Model.DonationLevels)
            {
                <li>
                    <a href="#"><img src="img/gallery/gallery-img-2-thumb.jpg" alt="Popular Post"></a>
                    <h6><a href="#">@item.Title</a></h6>
                    <em>$@item.Amount | Redeemed: @item.RemainingQuantity out of @item.Quantity</em>
                </li>
            }
        </ul>
        <h5 class="title-bg">Make A Contribution</h5>
        <div id="payment-form"></div>
    </div>
</div>

@section scripts{

    <script src="https://js.braintreegateway.com/v2/braintree.js"></script>

    <script>
        var clientToken = "";

        braintree.setup(clientToken, "dropin", {
            container: "payment-form"
        });
    </script>

    <script>
        var app = angular.module("app", []);

        app.controller("contributionController", function ($http, $scope) {

            $scope.submitted = false;

            $scope.loading = false;

            $scope.noContribution = true;

            $scope.makeContribution = function () {
                $http.post('/campaign/makecontribution', id, input).then(function () {
                    $scope.submitted = true;
                });
            }

        });
    </script>
}
